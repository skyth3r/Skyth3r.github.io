{{ define "main" }}

{{ $description := .Description }}
{{ $isTagsHome := eq .RelPermalink "/tags/" }}

<main class="h-screen overflow-y-auto">
  <section class="w-full md:max-w-xl xl:max-w-4xl 2xl:max-w-7xl mx-auto flex flex-col px-6 py-20">
    
    {{ if $isTagsHome }}
    <!-- Main Tags Page: Show all available tags -->
    <a href="{{ .Permalink }}" class="inline-block">
      <h2 class="font-bold text-4xl lg:text-6xl py-1 px-3 mb-4 inline-block">{{ .Title }}</h2>
    </a>
    
    {{ if $description }}
    <div class="mb-6 ml-3">
      <p class="text-lg text-slate-600 dark:text-slate-400">{{ $description }}</p>
    </div>
    {{ end }}
    
    <div class="space-y-2.5 grid grid-cols-1 lg:grid-cols-2 gap-2 lg:gap-4">
      {{ range $tagName, $taxonomy := .Site.Taxonomies.tags }}
      {{ $tagCount := len $taxonomy }}
      <a class="block px-3 py-4 row-span-2 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-md" href="{{ "/tags/" | relURL }}{{ $tagName | urlize }}/">
        <h3 class="text-lg font-semibold mb-0.5 lg:text-xl 2xl:text-3xl">#{{ $tagName }}</h3>
        <div class="text-sm text-slate-500 dark:text-slate-400 line-clamp-2">
          {{ $tagCount }} {{ if eq $tagCount 1 }}post{{ else }}posts{{ end }}
        </div>
        <p
          class="underline decoration-slate-500 text-slate-500 underline-offset-8 font-medium mt-2 hover:text-slate-800 hover:decoration-slate-800 dark:hover:text-slate-400 dark:hover:decoration-slate-400">
          View →</p>
      </a>
      {{ end }}
    </div>
    
    {{ else }}
    <!-- Individual Tag Page: Show posts with this tag -->
    {{ $tagName := .Title }}
    {{ $pageCount := len .Data.Pages }}
    
    <!-- Header -->
    <div class="mb-8">
      <a href="{{ .Permalink }}" class="inline-block">
        <h1 class="font-bold text-4xl lg:text-6xl py-1 px-3 mb-4 inline-block">#{{ $tagName | lower }}</h1>
      </a>
      <div class="ml-3">
        <p class="text-lg text-slate-600 dark:text-slate-400">
          {{ $pageCount }} {{ if eq $pageCount 1 }}post{{ else }}posts{{ end }} tagged with <span class="font-semibold">#{{ $tagName | lower }}</span>
        </p>
        <a href="/tags/" class="text-sm text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 underline mt-2 inline-block">
          ← Browse all tags
        </a>
      </div>
    </div>

    <!-- Posts Grid -->
    <div class="space-y-2.5 grid grid-cols-1 lg:grid-cols-2 gap-2 lg:gap-4">
      {{ range .Data.Pages -}}
      <article class="block px-3 py-4 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-md">
        <a href="{{ .RelPermalink }}" class="block">
          <!-- Post Image if exists -->
          {{ if .Params.images }}
          {{ range first 1 .Params.images }}
          <img class="rounded max-w-full mb-4" src="{{ . }}" alt="{{ $.Title }}" />
          {{ end }}
          {{ end }}
          
          <!-- Post Title -->
          <h2 class="text-lg font-semibold mb-2 lg:text-xl 2xl:text-2xl">{{ .Title }}</h2>
          
          <!-- Post Description -->
          {{ with .Description }}
          <div class="text-sm text-slate-500 dark:text-slate-400 line-clamp-3 mb-3">
            {{ . }}
          </div>
          {{ end }}
          
          <!-- Post Meta -->
          <div class="text-xs text-slate-400 dark:text-slate-500 mb-2">
            {{ if .Date }}
            <time datetime="{{ .Date.Format "2006-01-02" }}">
              {{ .Date.Format "January 2, 2006" }}
            </time>
            {{ end }}
            {{ if .ReadingTime }}
            <span class="mx-1">•</span>
            <span>{{ .ReadingTime }} min read</span>
            {{ end }}
          </div>
          
          <!-- All Tags for this post -->
          {{ with .Params.tags }}
          <div class="flex flex-wrap gap-1 mb-3">
            {{ range . }}
            <span class="inline-block bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-xs px-2 py-1 rounded-full">
              #{{ . | lower }}
            </span>
            {{ end }}
          </div>
          {{ end }}
          
          <!-- Read More Link -->
          <p class="underline decoration-slate-500 text-slate-500 underline-offset-8 font-medium hover:text-slate-800 hover:decoration-slate-800 dark:hover:text-slate-400 dark:hover:decoration-slate-400">
            Read post →
          </p>
        </a>
      </article>
      {{ end -}}
    </div>

    <!-- Empty State -->
    {{ if eq $pageCount 0 }}
    <div class="text-center py-12">
      <h3 class="text-xl font-semibold text-slate-600 dark:text-slate-400 mb-2">No articles found</h3>
      <p class="text-slate-500 dark:text-slate-400 mb-4">There are no articles tagged with #{{ $tagName | lower }} yet.</p>
      <a href="/articles/" class="text-blue-600 dark:text-blue-400 hover:underline">
        Browse all articles →
      </a>
    </div>
    {{ end }}
    
    {{ end }}
  </section>
</main>

{{ end }}